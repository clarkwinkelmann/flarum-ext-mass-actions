(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var s in e)t.o(e,s)&&!t.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:e[s]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const e=flarum.core.compat["forum/app"];var s=t.n(e);const a=flarum.core.compat["common/extend"],o=flarum.core.compat["common/components/Dropdown"];var r=t.n(o);const i=flarum.core.compat["common/helpers/listItems"];var c=t.n(i);const u=flarum.core.compat["common/utils/ItemList"];var l=t.n(u);const d=flarum.core.compat["forum/components/IndexPage"];var f=t.n(d);const k=flarum.core.compat["forum/components/DiscussionListItem"];var h=t.n(k);const p=flarum.core.compat["forum/components/DiscussionsUserPage"];var v=t.n(p);function g(t,n){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},g(t,n)}const b=flarum.core.compat["common/Component"];var w=t.n(b);const y=flarum.core.compat["common/helpers/icon"];var P=t.n(y),S=function(t){var n,e;function s(){return t.apply(this,arguments)||this}return e=t,(n=s).prototype=Object.create(e.prototype),n.prototype.constructor=n,g(n,e),s.prototype.view=function(){return m(".MassSelectControl",{className:this.attrs.state?"checked":"",role:"checkbox",onclick:this.attrs.onchange},P()(this.attrs.state?"fas fa-check-square":"far fa-square"))},s}(w()),D=function(){function t(t){this.type=void 0,this.ids=[],this.rangeStartId=null,this.listState=null,this.type=t}var n=t.prototype;return n.indexOf=function(t){return this.ids.indexOf(t.id()||"")},n.contains=function(t){return-1!==this.indexOf(t)},n.toggle=function(t,n){if(void 0===n&&(n=!1),!t.id())throw"Missing ID in model";if(n&&this.rangeStartId){var e=this.allCandidates(),a=s().store.getById(this.type,this.rangeStartId),o=e.indexOf(a),r=e.indexOf(t);if(o>=0&&r>=0&&this.contains(a)!==this.contains(t)){if(o>r){var i=[r,o];o=i[0],r=i[1]}return void e.slice(o,r+1).forEach((this.contains(t)?this.remove:this.add).bind(this))}}var c=this.indexOf(t);-1===c?this.ids.push(t.id()):this.ids.splice(c,1),this.rangeStartId=t.id()},n.add=function(t){if(!t.id())throw"Missing ID in model";this.contains(t)||this.ids.push(t.id())},n.remove=function(t){if(!t.id())throw"Missing ID in model";var n=this.indexOf(t);-1!==n&&this.ids.splice(n,1)},n.allCandidates=function(){var t=[];return(this.listState||s().discussions).getPages().forEach((function(n){t.push.apply(t,n.items)})),t},n.setListState=function(t){this.listState=t},n.addAll=function(t){var n=this;void 0===t&&(t=function(){return!0}),this.allCandidates().forEach((function(e){t(e)&&n.add(e)})),this.rangeStartId=null},n.clear=function(){this.ids=[],this.rangeStartId=null},n.count=function(){return this.ids.length},n.callbackWithModel=function(t){var n=this;return function(e){return t(s().store.getById(n.type,e))}},n.forEach=function(t){this.ids.forEach(this.callbackWithModel(t))},n.forEachPromise=function(t){return Promise.all(this.ids.map(this.callbackWithModel(t)))},n.some=function(t){return this.ids.some(this.callbackWithModel(t))},n.all=function(){var t=this;return this.ids.map((function(n){return s().store.getById(t.type,n)}))},t}();const x=flarum.core.compat["common/components/Button"];var A=t.n(x);const I=flarum.core.compat["forum/utils/DiscussionControls"];var O=t.n(I);const E=flarum.core.compat["common/utils/extractText"];var L=t.n(E);function C(){return C=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},C.apply(this,arguments)}function B(t){return new Proxy(t[0],{get:function(n,e,s){return"save"===e?function(n,e){return void 0===e&&(e={}),Promise.all(t.map((function(t){return t.save(C({},n),C({},e))})))}:Reflect.get(n,e,s)}})}const H=flarum.core.compat["common/components/Tooltip"];var M=t.n(H),N=function(){function t(){}return t.prototype.view=function(t){return M().component({text:t.attrs.title},A().component({"aria-label":t.attrs.title,icon:t.attrs.icon,className:"Button Button--icon",onclick:t.attrs.onclick,disabled:t.attrs.disabled}))},t}();function T(t){var n=s().current.get("mass-select");if(!n||0===n.count())return t;t.remove("refresh"),t.remove("markAllAsRead"),t.add("mass-markAsRead",m(N,{title:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.markAsRead"),icon:"fas fa-check",onclick:function(){n.forEachPromise((function(t){return t.isUnread()?t.save({lastReadPostNumber:t.lastPostNumber()}):Promise.resolve()})).then((function(){m.redraw()}))}}));var e=n.some((function(t){return t.isHidden()}));if(s().forum.attribute("canHideDiscussionsSometime")&&t.add("mass-hide",m(N,{title:e?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.restore"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.hide"),icon:e?"fas fa-reply":"fas fa-trash-alt",onclick:function(){n.forEachPromise((function(t){return t.canHide()?e?O().restoreAction.call(t):O().hideAction.call(t):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return!!t.canHide()}))})),s().forum.attribute("canDeleteDiscussionsSometime")&&e){var a=n.all().filter((function(t){return t.canDelete()&&t.isHidden()})).length;t.add("mass-delete",m(N,{title:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.delete"),icon:"fas fa-times",onclick:function(){confirm(L()(s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.deleteConfirmation",{count:a})))&&n.forEachPromise((function(t){return t.canDelete()&&t.isHidden()?t.delete().then((function(){return s().discussions.removeDiscussion(t)})):Promise.resolve()})).then((function(){m.redraw()}))},disabled:0===a}))}if(s().forum.attribute("canLockDiscussionsSometime")){var o=n.some((function(t){return t.attribute("isLocked")}));t.add("mass-lock",m(N,{title:o?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unlock"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.lock"),icon:o?"fas fa-unlock":"fas fa-lock",onclick:function(){n.forEachPromise((function(t){return t.attribute("canLock")?t.save({isLocked:!o}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canLock")}))}))}if(s().forum.attribute("canStickyDiscussionsSometime")){var i=n.some((function(t){return t.attribute("isSticky")}));t.add("mass-sticky",m(N,{title:i?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unsticky"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.sticky"),icon:"fas fa-thumbtack",onclick:function(){n.forEachPromise((function(t){return t.attribute("canSticky")?t.save({isSticky:!i}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canSticky")}))}))}return s().forum.attribute("canTagDiscussionsSometime")&&t.add("mass-tags",r().component({buttonClassName:"Button",label:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags"),disabled:!n.some((function(t){return t.attribute("canTag")}))},[A().component({onclick:function(){s().modal.show(flarum.core.compat["tags/forum/components/TagDiscussionModal"],{discussion:B(n.all())})}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-edit")),s().store.all("tags").map((function(t){return A().component({onclick:function(){n.forEachPromise((function(n){if(!n.attribute("canTag"))return Promise.resolve();var e=n.tags()||[];return e.some((function(n){return n.id()===t.id()}))?Promise.resolve():(e.push(t),n.save({relationships:{tags:e}}))})).then((function(){m.redraw()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-add",{tag:t.name()}))}))])),t}function j(t){var n=new(l()),e="far fa-square",a=s().current.get("mass-select").count();return a>0&&(e=a===s().discussions.getPages().reduce((function(t,n){return t+n.items.length}),0)?"fas fa-check-square":"fas fa-minus-square"),n.add("all",A().component({onclick:function(){s().current.get("mass-select").addAll()}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.all"))),n.add("clear",A().component({onclick:function(){s().current.get("mass-select").clear()}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.none"))),n.add("read",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isRead()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.read"))),n.add("unread",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isUnread()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.unread"))),n.add("visible",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return!t.isHidden()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.visible"))),n.add("hidden",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isHidden()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.hidden"))),"flarum-lock"in flarum.extensions&&(n.add("locked",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.attribute("isLocked")}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.locked"))),n.add("unlocked",A().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return!t.attribute("isLocked")}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.unlocked")))),t.add("mass-select",m(".ButtonGroup.Dropdown.Dropdown--split.dropdown",{},[A().component({className:"Button SplitDropdown-button MassSelectControl"+(a>0?" checked":""),onclick:function(){0===s().current.get("mass-select").count()?s().current.get("mass-select").addAll():s().current.get("mass-select").clear()}},P()(e)),m("button.Dropdown-toggle.Button.Button--icon",{"data-toggle":"dropdown"},P()("fas fa-caret-down",{className:"Button-caret"})),m("ul.Dropdown-menu.dropdown-menu",c()(n.toArray()))]),100),t}const R=flarum.core.compat["common/Store"];var _=t.n(R);s().initializers.add("mass-actions",(function(){(0,a.extend)(r().prototype,"getButton",(function(t){t.attrs.disabled=this.attrs.disabled})),(0,a.extend)(f().prototype,"oninit",(function(){s().current.set("mass-select",new D("discussions"))})),(0,a.extend)(f().prototype,"viewItems",(function(t){s().forum.attribute("massControls")&&j(t)})),(0,a.extend)(f().prototype,"actionItems",(function(t){s().forum.attribute("massControls")&&T(t)})),(0,a.extend)(v().prototype,"show",(function(){s().current.set("mass-select",new D("discussions")),s().current.get("mass-select").setListState(this.state)})),(0,a.extend)(v().prototype,"content",(function(t){s().forum.attribute("massControls")&&t.children.unshift(m(".IndexPage-toolbar",[m(".IndexPage-toolbar-view",c()(j(new(l())).toArray())),m(".IndexPage-toolbar-action",c()(T(new(l())).toArray()))]))})),(0,a.extend)(h().prototype,"view",(function(t){var n=this;(s().current.matches(f())||s().current.matches(v()))&&s().forum.attribute("massControls")&&t.children.forEach((function(t){if(t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")){var e=s().current.get("mass-select");t.children.unshift(m(".DiscussionListItem-select",S.component({state:e.contains(n.attrs.discussion),onchange:function(t){e.toggle(n.attrs.discussion,t.shiftKey)}})))}}))})),(0,a.extend)(h().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var n;return null==(n=s().current.get("mass-select"))?void 0:n.contains(t.attrs.discussion)}))})),(0,a.extend)(h().prototype,"elementAttrs",(function(t){var n;null!=(n=s().current.get("mass-select"))&&n.contains(this.attrs.discussion)&&(t.className+=" DiscussionListItem--selected")})),(0,a.extend)(f().prototype,"actionItems",(function(t){var n=s().current.get("mass-select");if(n&&0!==n.count()){t.remove("refresh"),t.remove("markAllAsRead"),t.add("mass-markAsRead",m(N,{title:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.markAsRead"),icon:"fas fa-check",onclick:function(){n.forEachPromise((function(t){return t.isUnread()?t.save({lastReadPostNumber:t.lastPostNumber()}):Promise.resolve()})).then((function(){m.redraw()}))}}));var e=n.some((function(t){return t.isHidden()}));if(s().forum.attribute("canHideDiscussionsSometime")&&t.add("mass-hide",m(N,{title:e?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.restore"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.hide"),icon:e?"fas fa-reply":"fas fa-trash-alt",onclick:function(){n.forEachPromise((function(t){return t.canHide()?e?O().restoreAction.call(t):O().hideAction.call(t):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return!!t.canHide()}))})),s().forum.attribute("canDeleteDiscussionsSometime")&&e){var a=n.all().filter((function(t){return t.canDelete()&&t.isHidden()})).length;t.add("mass-delete",m(N,{title:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.delete"),icon:"fas fa-times",onclick:function(){confirm(L()(s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.deleteConfirmation",{count:a})))&&n.forEachPromise((function(t){return t.canDelete()&&t.isHidden()?t.delete().then((function(){return s().discussions.removeDiscussion(t)})):Promise.resolve()})).then((function(){m.redraw()}))},disabled:0===a}))}if(s().forum.attribute("canLockDiscussionsSometime")){var o=n.some((function(t){return t.attribute("isLocked")}));t.add("mass-lock",m(N,{title:o?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unlock"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.lock"),icon:o?"fas fa-unlock":"fas fa-lock",onclick:function(){n.forEachPromise((function(t){return t.attribute("canLock")?t.save({isLocked:!o}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canLock")}))}))}if(s().forum.attribute("canStickyDiscussionsSometime")){var i=n.some((function(t){return t.attribute("isSticky")}));t.add("mass-sticky",m(N,{title:i?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unsticky"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.sticky"),icon:"fas fa-thumbtack",onclick:function(){n.forEachPromise((function(t){return t.attribute("canSticky")?t.save({isSticky:!i}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canSticky")}))}))}s().forum.attribute("canTagDiscussionsSometime")&&t.add("mass-tags",r().component({buttonClassName:"Button",label:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags"),disabled:!n.some((function(t){return t.attribute("canTag")}))},[A().component({onclick:function(){s().modal.show(flarum.core.compat["tags/forum/components/TagDiscussionModal"],{discussion:B(n.all())})}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-edit")),s().store.all("tags").map((function(t){return A().component({onclick:function(){n.forEachPromise((function(n){if(!n.attribute("canTag"))return Promise.resolve();var e=n.tags()||[];return e.some((function(n){return n.id()===t.id()}))?Promise.resolve():(e.push(t),n.save({relationships:{tags:e}}))})).then((function(){m.redraw()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-add",{tag:t.name()}))}))]))}})),(0,a.override)(_().prototype,"remove",(function(t,n){var e=s().current.get("mass-select");return e&&e.type===n.data.type&&e.remove(n),t(n)}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map