(()=>{var t={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return t.d(o,{a:o}),o},d:(n,o)=>{for(var e in o)t.o(o,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:o[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const o=flarum.core.compat["forum/app"];var e=t.n(o);const s=flarum.core.compat["common/extend"],r=flarum.core.compat["common/components/Dropdown"];var a=t.n(r);const i=flarum.core.compat["forum/components/IndexPage"];var c=t.n(i);const u=flarum.core.compat["forum/components/DiscussionListItem"];var l=t.n(u);const d=flarum.core.compat["common/components/Button"];var f=t.n(d);const p=flarum.core.compat["common/utils/ItemList"];var h=t.n(p);const g=flarum.core.compat["common/helpers/icon"];var v=t.n(g);const k=flarum.core.compat["common/helpers/listItems"];var b=t.n(k);function y(t,n){return y=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},y(t,n)}const w=flarum.core.compat["common/Component"];var P=function(t){var n,o;function e(){return t.apply(this,arguments)||this}return o=t,(n=e).prototype=Object.create(o.prototype),n.prototype.constructor=n,y(n,o),e.prototype.view=function(){return m(".MassSelectControl",{className:this.attrs.state?"checked":"",role:"checkbox",onclick:this.attrs.onchange},v()(this.attrs.state?"fas fa-check-square":"far fa-square"))},e}(t.n(w)()),x=function(){function t(t){this.type=void 0,this.ids=[],this.rangeStartId=null,this.type=t}var n=t.prototype;return n.indexOf=function(t){return this.ids.indexOf(t.id()||"")},n.contains=function(t){return-1!==this.indexOf(t)},n.toggle=function(t,n){if(void 0===n&&(n=!1),!t.id())throw"Missing ID in model";if(n&&this.rangeStartId){var o=this.allCandidates(),s=e().store.getById(this.type,this.rangeStartId),r=o.indexOf(s),a=o.indexOf(t);if(r>=0&&a>=0&&this.contains(s)!==this.contains(t)){if(r>a){var i=[a,r];r=i[0],a=i[1]}return void o.slice(r,a+1).forEach((this.contains(t)?this.remove:this.add).bind(this))}}var c=this.indexOf(t);-1===c?this.ids.push(t.id()):this.ids.splice(c,1),this.rangeStartId=t.id()},n.add=function(t){if(!t.id())throw"Missing ID in model";this.contains(t)||this.ids.push(t.id())},n.remove=function(t){if(!t.id())throw"Missing ID in model";var n=this.indexOf(t);-1!==n&&this.ids.splice(n,1)},n.allCandidates=function(){var t=[];return e().discussions.getPages().forEach((function(n){t.push.apply(t,n.items)})),t},n.addAll=function(){this.allCandidates().forEach(this.add.bind(this)),this.rangeStartId=null},n.clear=function(){this.ids=[],this.rangeStartId=null},n.count=function(){return this.ids.length},n.callbackWithModel=function(t){var n=this;return function(o){return t(e().store.getById(n.type,o))}},n.forEach=function(t){this.ids.forEach(this.callbackWithModel(t))},n.forEachPromise=function(t){return Promise.all(this.ids.map(this.callbackWithModel(t)))},n.some=function(t){return this.ids.some(this.callbackWithModel(t))},n.all=function(){var t=this;return this.ids.map((function(n){return e().store.getById(t.type,n)}))},t}();const I=flarum.core.compat["forum/utils/DiscussionControls"];var O=t.n(I);function D(){return D=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}return t},D.apply(this,arguments)}const S=flarum.core.compat["common/components/Tooltip"];var B=t.n(S),M=function(){function t(){}return t.prototype.view=function(t){return B().component({text:t.attrs.title},f().component({"aria-label":t.attrs.title,icon:t.attrs.icon,className:"Button Button--icon",onclick:t.attrs.onclick,disabled:t.attrs.disabled}))},t}();e().initializers.add("mass-actions",(function(){(0,s.extend)(a().prototype,"getButton",(function(t){t.attrs.disabled=this.attrs.disabled})),(0,s.extend)(c().prototype,"viewItems",(function(t){if(e().forum.attribute("massControls")){var n=new(h()),o="far fa-square",s=e().current.get("mass-select").count();s>0&&(o=s===e().discussions.getPages().reduce((function(t,n){return t+n.items.length}),0)?"fas fa-check-square":"fas fa-minus-square"),n.add("all",f().component({onclick:function(){e().current.get("mass-select").addAll()}},e().translator.trans("clarkwinkelmann-mass-actions.forum.select.all"))),n.add("clear",f().component({onclick:function(){e().current.get("mass-select").clear()}},e().translator.trans("clarkwinkelmann-mass-actions.forum.select.none"))),t.add("mass-select",m(".ButtonGroup.Dropdown.Dropdown--split.dropdown",{},[f().component({className:"Button SplitDropdown-button MassSelectControl"+(s>0?" checked":""),onclick:function(){0===e().current.get("mass-select").count()?e().current.get("mass-select").addAll():e().current.get("mass-select").clear()}},v()(o)),m("button.Dropdown-toggle.Button.Button--icon",{"data-toggle":"dropdown"},v()("fas fa-caret-down",{className:"Button-caret"})),m("ul.Dropdown-menu.dropdown-menu",b()(n.toArray()))]),100)}})),(0,s.extend)(l().prototype,"view",(function(t){var n=this;e().current.matches(c())&&e().forum.attribute("massControls")&&t.children.forEach((function(t){if(t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")){var o=e().current.get("mass-select");t.children.unshift(m(".DiscussionListItem-select",P.component({state:o.contains(n.attrs.discussion),onchange:function(t){o.toggle(n.attrs.discussion,t.shiftKey)}})))}}))})),(0,s.extend)(l().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var n;return null==(n=e().current.get("mass-select"))?void 0:n.contains(t.attrs.discussion)}))})),(0,s.extend)(l().prototype,"elementAttrs",(function(t){var n;null!=(n=e().current.get("mass-select"))&&n.contains(this.attrs.discussion)&&(t.className+=" DiscussionListItem--selected")})),(0,s.extend)(c().prototype,"oninit",(function(){e().current.set("mass-select",new x("discussions"))})),(0,s.extend)(c().prototype,"actionItems",(function(t){var n=e().current.get("mass-select");if(n&&0!==n.count()){if(t.remove("refresh"),t.remove("markAllAsRead"),t.add("mass-markAsRead",m(M,{title:e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.markAsRead"),icon:"fas fa-check",onclick:function(){n.forEachPromise((function(t){return t.isUnread()?t.save({lastReadPostNumber:t.lastPostNumber()}):Promise.resolve()})).then((function(){m.redraw()}))}})),e().forum.attribute("canHideDiscussionsSometime")){var o=n.some((function(t){return t.isHidden()}));t.add("mass-hide",m(M,{title:o?e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.restore"):e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.hide"),icon:o?"fas fa-reply":"fas fa-trash-alt",onclick:function(){n.forEachPromise((function(t){return t.canHide()?o?O().restoreAction.call(t):O().hideAction.call(t):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.canHide()}))}))}if(e().forum.attribute("canLockDiscussionsSometime")){var s=n.some((function(t){return t.attribute("isLocked")}));t.add("mass-lock",m(M,{title:s?e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unlock"):e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.lock"),icon:s?"fas fa-unlock":"fas fa-lock",onclick:function(){n.forEachPromise((function(t){return t.attribute("canLock")?t.save({isLocked:!s}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canLock")}))}))}e().forum.attribute("canTagDiscussionsSometime")&&t.add("mass-tags",a().component({buttonClassName:"Button",label:e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags"),disabled:!n.some((function(t){return t.attribute("canTag")}))},[f().component({onclick:function(){var t;e().modal.show(flarum.core.compat["tags/forum/components/TagDiscussionModal"],{discussion:(t=n.all(),new Proxy(t[0],{get:function(n,o,e){return"save"===o?function(n,o){return void 0===o&&(o={}),Promise.all(t.map((function(t){return t.save(D({},n),D({},o))})))}:Reflect.get(n,o,e)}}))})}},e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-edit")),e().store.all("tags").map((function(t){return f().component({onclick:function(){n.forEachPromise((function(n){if(!n.attribute("canTag"))return Promise.resolve();var o=n.tags()||[];return o.some((function(n){return n.id()===t.id()}))?Promise.resolve():(o.push(t),n.save({relationships:{tags:o}}))})).then((function(){m.redraw()}))}},e().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-add",{tag:t.name()}))}))]))}}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map