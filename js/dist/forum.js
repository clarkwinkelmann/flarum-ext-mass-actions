(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var s in e)t.o(e,s)&&!t.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:e[s]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const e=flarum.core.compat["forum/app"];var s=t.n(e);const o=flarum.core.compat["common/extend"],r=flarum.core.compat["common/components/Dropdown"];var a=t.n(r);const c=flarum.core.compat["forum/components/IndexPage"];var i=t.n(c);const l=flarum.core.compat["forum/components/DiscussionListItem"];var u=t.n(l);const d=flarum.core.compat["common/components/Button"];var f=t.n(d);const p=flarum.core.compat["common/utils/ItemList"];var h=t.n(p);const k=flarum.core.compat["common/helpers/icon"];var g=t.n(k);const v=flarum.core.compat["common/helpers/listItems"];var b=t.n(v);function w(t,n){return w=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},w(t,n)}const y=flarum.core.compat["common/Component"];var P=function(t){var n,e;function s(){return t.apply(this,arguments)||this}return e=t,(n=s).prototype=Object.create(e.prototype),n.prototype.constructor=n,w(n,e),s.prototype.view=function(){return m(".MassSelectControl",{className:this.attrs.state?"checked":"",role:"checkbox",onclick:this.attrs.onchange},g()(this.attrs.state?"fas fa-check-square":"far fa-square"))},s}(t.n(y)()),x=function(){function t(t){this.type=void 0,this.ids=[],this.rangeStartId=null,this.type=t}var n=t.prototype;return n.indexOf=function(t){return this.ids.indexOf(t.id()||"")},n.contains=function(t){return-1!==this.indexOf(t)},n.toggle=function(t,n){if(void 0===n&&(n=!1),!t.id())throw"Missing ID in model";if(n&&this.rangeStartId){var e=this.allCandidates(),o=s().store.getById(this.type,this.rangeStartId),r=e.indexOf(o),a=e.indexOf(t);if(r>=0&&a>=0&&this.contains(o)!==this.contains(t)){if(r>a){var c=[a,r];r=c[0],a=c[1]}return void e.slice(r,a+1).forEach((this.contains(t)?this.remove:this.add).bind(this))}}var i=this.indexOf(t);-1===i?this.ids.push(t.id()):this.ids.splice(i,1),this.rangeStartId=t.id()},n.add=function(t){if(!t.id())throw"Missing ID in model";this.contains(t)||this.ids.push(t.id())},n.remove=function(t){if(!t.id())throw"Missing ID in model";var n=this.indexOf(t);-1!==n&&this.ids.splice(n,1)},n.allCandidates=function(){var t=[];return s().discussions.getPages().forEach((function(n){t.push.apply(t,n.items)})),t},n.addAll=function(t){var n=this;void 0===t&&(t=function(){return!0}),this.allCandidates().forEach((function(e){t(e)&&n.add(e)})),this.rangeStartId=null},n.clear=function(){this.ids=[],this.rangeStartId=null},n.count=function(){return this.ids.length},n.callbackWithModel=function(t){var n=this;return function(e){return t(s().store.getById(n.type,e))}},n.forEach=function(t){this.ids.forEach(this.callbackWithModel(t))},n.forEachPromise=function(t){return Promise.all(this.ids.map(this.callbackWithModel(t)))},n.some=function(t){return this.ids.some(this.callbackWithModel(t))},n.all=function(){var t=this;return this.ids.map((function(n){return s().store.getById(t.type,n)}))},t}();const I=flarum.core.compat["forum/utils/DiscussionControls"];var O=t.n(I);function D(){return D=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},D.apply(this,arguments)}const A=flarum.core.compat["common/components/Tooltip"];var S=t.n(A),B=function(){function t(){}return t.prototype.view=function(t){return S().component({text:t.attrs.title},f().component({"aria-label":t.attrs.title,icon:t.attrs.icon,className:"Button Button--icon",onclick:t.attrs.onclick,disabled:t.attrs.disabled}))},t}();s().initializers.add("mass-actions",(function(){(0,o.extend)(a().prototype,"getButton",(function(t){t.attrs.disabled=this.attrs.disabled})),(0,o.extend)(i().prototype,"viewItems",(function(t){if(s().forum.attribute("massControls")){var n=new(h()),e="far fa-square",o=s().current.get("mass-select").count();o>0&&(e=o===s().discussions.getPages().reduce((function(t,n){return t+n.items.length}),0)?"fas fa-check-square":"fas fa-minus-square"),n.add("all",f().component({onclick:function(){s().current.get("mass-select").addAll()}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.all"))),n.add("clear",f().component({onclick:function(){s().current.get("mass-select").clear()}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.none"))),n.add("read",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isRead()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.read"))),n.add("unread",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isUnread()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.unread"))),n.add("visible",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return!t.isHidden()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.visible"))),n.add("hidden",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.isHidden()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.hidden"))),"flarum-lock"in flarum.extensions&&(n.add("locked",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return t.attribute("isLocked")}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.locked"))),n.add("unlocked",f().component({onclick:function(){s().current.get("mass-select").clear(),s().current.get("mass-select").addAll((function(t){return!t.attribute("isLocked")}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.select.unlocked")))),t.add("mass-select",m(".ButtonGroup.Dropdown.Dropdown--split.dropdown",{},[f().component({className:"Button SplitDropdown-button MassSelectControl"+(o>0?" checked":""),onclick:function(){0===s().current.get("mass-select").count()?s().current.get("mass-select").addAll():s().current.get("mass-select").clear()}},g()(e)),m("button.Dropdown-toggle.Button.Button--icon",{"data-toggle":"dropdown"},g()("fas fa-caret-down",{className:"Button-caret"})),m("ul.Dropdown-menu.dropdown-menu",b()(n.toArray()))]),100)}})),(0,o.extend)(u().prototype,"view",(function(t){var n=this;s().current.matches(i())&&s().forum.attribute("massControls")&&t.children.forEach((function(t){if(t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")){var e=s().current.get("mass-select");t.children.unshift(m(".DiscussionListItem-select",P.component({state:e.contains(n.attrs.discussion),onchange:function(t){e.toggle(n.attrs.discussion,t.shiftKey)}})))}}))})),(0,o.extend)(u().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var n;return null==(n=s().current.get("mass-select"))?void 0:n.contains(t.attrs.discussion)}))})),(0,o.extend)(u().prototype,"elementAttrs",(function(t){var n;null!=(n=s().current.get("mass-select"))&&n.contains(this.attrs.discussion)&&(t.className+=" DiscussionListItem--selected")})),(0,o.extend)(i().prototype,"oninit",(function(){s().current.set("mass-select",new x("discussions"))})),(0,o.extend)(i().prototype,"actionItems",(function(t){var n=s().current.get("mass-select");if(n&&0!==n.count()){if(t.remove("refresh"),t.remove("markAllAsRead"),t.add("mass-markAsRead",m(B,{title:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.markAsRead"),icon:"fas fa-check",onclick:function(){n.forEachPromise((function(t){return t.isUnread()?t.save({lastReadPostNumber:t.lastPostNumber()}):Promise.resolve()})).then((function(){m.redraw()}))}})),s().forum.attribute("canHideDiscussionsSometime")){var e=n.some((function(t){return t.isHidden()}));t.add("mass-hide",m(B,{title:e?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.restore"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.hide"),icon:e?"fas fa-reply":"fas fa-trash-alt",onclick:function(){n.forEachPromise((function(t){return t.canHide()?e?O().restoreAction.call(t):O().hideAction.call(t):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.canHide()}))}))}if(s().forum.attribute("canLockDiscussionsSometime")){var o=n.some((function(t){return t.attribute("isLocked")}));t.add("mass-lock",m(B,{title:o?s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.unlock"):s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.lock"),icon:o?"fas fa-unlock":"fas fa-lock",onclick:function(){n.forEachPromise((function(t){return t.attribute("canLock")?t.save({isLocked:!o}):Promise.resolve()})).then((function(){m.redraw()}))},disabled:!n.some((function(t){return t.attribute("canLock")}))}))}s().forum.attribute("canTagDiscussionsSometime")&&t.add("mass-tags",a().component({buttonClassName:"Button",label:s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags"),disabled:!n.some((function(t){return t.attribute("canTag")}))},[f().component({onclick:function(){var t;s().modal.show(flarum.core.compat["tags/forum/components/TagDiscussionModal"],{discussion:(t=n.all(),new Proxy(t[0],{get:function(n,e,s){return"save"===e?function(n,e){return void 0===e&&(e={}),Promise.all(t.map((function(t){return t.save(D({},n),D({},e))})))}:Reflect.get(n,e,s)}}))})}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-edit")),s().store.all("tags").map((function(t){return f().component({onclick:function(){n.forEachPromise((function(n){if(!n.attribute("canTag"))return Promise.resolve();var e=n.tags()||[];return e.some((function(n){return n.id()===t.id()}))?Promise.resolve():(e.push(t),n.save({relationships:{tags:e}}))})).then((function(){m.redraw()}))}},s().translator.trans("clarkwinkelmann-mass-actions.forum.actions.tags-add",{tag:t.name()}))}))]))}}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map